<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PosterWall DeepRestore</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-slate-950 text-slate-200 font-sans">

    <div id="app">
        <!-- Header -->
        <header class="bg-slate-900 border-b border-slate-800 sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="bg-orange-600 p-2 rounded-lg text-white">
                        <i data-lucide="layers"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-white">PosterWall <span class="text-orange-500">DeepRestore</span></h1>
                        <p class="text-[10px] text-slate-400 uppercase font-bold">Procesamiento Hoja por Hoja</p>
                    </div>
                </div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto px-6 py-8">
            <!-- Upload View -->
            <div id="upload-view">
                <div class="flex flex-col items-center justify-center min-h-[60vh]">
                    <div id="drop-zone" class="w-full max-w-2xl border-2 border-dashed border-slate-700 rounded-2xl bg-slate-900/50 hover:bg-slate-900 hover:border-orange-500 transition-all cursor-pointer p-12 flex flex-col items-center gap-6">
                        <input id="fileInput" type="file" accept="image/*" class="hidden" />
                        <div class="p-6 bg-slate-800 rounded-full text-orange-500">
                            <i data-lucide="upload" class="w-12 h-12"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-white">Subir Imagen para Restaurar</h2>
                        <p class="text-slate-400 text-center">
                            El sistema dividirá la imagen y aplicará corrección de color y nitidez intensiva a cada parte individualmente.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Processing View -->
            <div id="processing-view" class="hidden">
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                    <!-- Control Panel -->
                    <div class="lg:col-span-4 space-y-6">
                        <!-- Grid Settings -->
                        <div id="settings-panel" class="bg-slate-900 border border-slate-800 p-6 rounded-2xl space-y-4">
                            <h3 class="font-bold text-white flex items-center gap-2"><i data-lucide="image" class="w-4 h-4"></i> Configuración Inicial</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="text-xs text-slate-500 uppercase font-bold">Columnas</label>
                                    <input id="cols-input" type="number" min="1" max="6" value="3" class="w-full bg-black border border-slate-700 rounded-lg py-2 text-center text-white" />
                                </div>
                                <div>
                                    <label class="text-xs text-slate-500 uppercase font-bold">Filas</label>
                                    <input id="rows-input" type="number" min="1" max="6" value="2" class="w-full bg-black border border-slate-700 rounded-lg py-2 text-center text-white" />
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button id="portrait-btn" class="flex-1 py-2 text-xs font-bold uppercase rounded bg-orange-600 text-white">Vertical</button>
                                <button id="landscape-btn" class="flex-1 py-2 text-xs font-bold uppercase rounded bg-slate-800">Horizontal</button>
                            </div>
                        </div>

                        <!-- Main Action Button -->
                        <div id="start-button-container">
                             <button id="start-btn" class="w-full bg-white text-black hover:bg-orange-50 font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-2 transition-transform active:scale-95">
                                <i data-lucide="zap" class="w-5 h-5 text-orange-600"></i> Iniciar Restauración Profunda
                            </button>
                        </div>
                       
                        <!-- Processing Status -->
                        <div id="processing-status-container" class="hidden bg-slate-900 border border-orange-500/50 p-6 rounded-2xl">
                            <div class="flex items-center gap-3 mb-2 text-orange-400 font-bold uppercase tracking-wider text-xs">
                                <i data-lucide="cpu" class="w-4 h-4 animate-spin"></i> 
                                <span id="processing-status-text">Procesando Hoja 1 de 6</span>
                            </div>
                            <div class="h-2 bg-slate-800 rounded-full overflow-hidden mb-4">
                                <div id="progress-bar" class="h-full bg-orange-500 transition-all duration-300" style="width: 0%"></div>
                            </div>
                            <p id="logs" class="font-mono text-xs text-slate-300"></p>
                        </div>

                        <!-- Final Download -->
                        <div id="download-container" class="hidden space-y-4">
                            <div class="bg-green-900/20 border border-green-500/50 p-4 rounded-xl text-green-400 flex items-center gap-3">
                                <i data-lucide="check" class="w-6 h-6"></i>
                                <div>
                                    <p class="font-bold">Restauración Finalizada</p>
                                    <p class="text-xs opacity-80">Todas las piezas han sido mejoradas.</p>
                                </div>
                            </div>
                            <button id="download-btn" class="w-full bg-orange-600 hover:bg-orange-500 text-white font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-2 transition-transform active:scale-95">
                                <i data-lucide="file-down" class="w-6 h-6"></i> Descargar PDF Completo
                            </button>
                            <button id="reset-btn" class="w-full text-slate-500 text-sm underline">Reiniciar</button>
                        </div>
                    </div>

                    <!-- Work Viewer -->
                    <div class="lg:col-span-8 space-y-4">
                        <div class="bg-black rounded-2xl border border-slate-800 p-1 min-h-[500px] flex flex-col relative overflow-hidden">
                            <div class="absolute top-4 left-4 z-10 bg-black/80 backdrop-blur text-white px-3 py-1 rounded-full text-xs font-mono border border-slate-700">
                                <span id="viewer-label">VISTA PREVIA</span>
                            </div>
                            <div id="canvas-container" class="flex-1 flex items-center justify-center bg-[radial-gradient(#334155_1px,transparent_1px)] bg-[size:20px_20px]">
                                <!-- Idle State -->
                                <div id="preview-idle" class="relative w-3/4 opacity-50 grayscale">
                                    <img id="preview-img" src="" class="w-full h-auto rounded border border-slate-700" alt="original" />
                                    <div id="preview-grid" class="absolute inset-0 grid gap-0.5"></div>
                                </div>
                                <!-- Processing State -->
                                <canvas id="canvas-processing" class="hidden max-w-full max-h-[600px] shadow-[0_0_50px_rgba(249,115,22,0.3)] border-2 border-orange-500/50"></canvas>
                            </div>
                        </div>
                        <div class="bg-slate-900 p-4 rounded-xl text-xs text-slate-400 border border-slate-800">
                            <p><strong class="text-white">Nota Técnica:</strong> La borrosidad de la imagen original se debe a la baja resolución de la captura. Este modo "DeepRestore" fuerza artificialmente el contraste y dibuja bordes sobre los objetos (High-Pass Filter) para simular nitidez al imprimir.</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="libs/jspdf.umd.min.js"></script>
    <script src="script.js"></script>
</body>
</html>